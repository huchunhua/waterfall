
var dataInt = [
    {
        "key":"d78545381eb183950a8bd921c01ae6c6bdfedceee34db-eUPD87",
        "width":2048,
        "height":2154,
    },
    {
        "key":"e6ea2216e0efbb723b2a93dd2252a0206997dd8243e7-pKJTlv",
        "width":318,
        "height":497,
    },
    {
        "key":"19e943754aea59bcbcd1c0192e7a1bbe0037eccb3308b-q90hOr",
        "width":440,
        "height":2305,
    },
    {
        "key":"3621c12a0c98b9733f05d0b02cd5dd47f964dd9a4f53-FEPBkh",
        "width":334,
        "height":375,
    },
    {
        "key":"d88100c7c01ad88971d4b510e4f68164f093183a1a5fe-GKtlxN",
        "width":900,
        "height":720,
    },
    {
        "key":"a7af7235b5f953a02c4b8b475d1545d95ad9e2ba21c16-x58Sr9",
        "width":516,
        "height":600,
    },
    {
        "key":"e8b455a261afcddb6e8b2b22497b06775f2e4ba8860d-F9N4xD",
        "width":300,
        "height":450,
    },
    {
        "key":"db1f8fbad6cae24e8f6308f7256f6e2f1bc56fb0a2287-jcWEHs",
        "width":800,
        "height":1200,
    },
    {
        "key":"091cedd95f30d42dc6bc5fa30be8c697e9bf72311205a-lZySAZ",
        "width":467,
        "height":362,
    },
    {
        "key":"2f09d59055c1b4cbf3e498171dce6e1b800a61b654e8-oH7iE3",
        "width":360,
        "height":540,
    },
    {
        "key":"4fea4cad2d96435923e59ba71dfac91cd2adc8421c912-SOYRRI",
        "width":1208,
        "height":720,
    },
    {
        "key":"c5cc9c2ad56a8ac93ea560baf9a5fc26dd6c00111a7b3-Deem01",
        "width":440,
        "height":769,
    },
    {
        "key":"03d476fd3e30dd94c37561ca2fb9084949f01c8961912-SMSkhu",
        "width":400,
        "height":225
    },
    {
        "key":"7275b8b45c4d7146eca630afc61425c58f73f00916a08-w9qD3k",
        "width":450,
        "height":600,
    },

    {
        "key":"cb09355cba44458ca025930d8c809f3e318f40ccc418-kYlWql",
        "width":478,
        "height":588,
    },
    {
        "key":"f5f7e51e5f27eaa270487923460a8d43cb929ad61d0cd-56PhLh",
        "width":619,
        "height":767,
    },
    {
        "key":"e8f3d07919796d4b84a81b5884e5dccc55c9b6aa46f27-P1GESr",
        "width":1000,
        "height":1500,
    },
    {
        "key":"ab21bc62b27a7d5ee6fe326d97938c9febde906825596-DkCVW6",
        "width":800,
        "height":669,
    },
    {
        "key":"7f574a17d877ee45e277dc435e4c82e830a15f1e1fa7b-rjKFRZ",
        "width":662,
        "height":960,
    },
    {
        "key":"8c722841f1e50cffd80d0ef7dbfba2519ba11177ead0e-WI60CB",
        "width":245,
        "height":252,
    },
    {
        "key":"d919e5145ae5940c736d340ceb17dd772dc35324e109-vBGKUj",
        "width":638,
        "height":425,
    },
    {
        "key":"3e6cc21477c64b318885af7a386e98b30872c0c236a45-I4ZswB",
        "width":626,
        "height":939,
    },
    {
        "key":"0b7fb02151157e56491ba28cec20adca1a0deb1365af0-swC0pq",
        "width":500,
        "height":648,
    },
    {
        "key":"bbd018bd3bafe2175a9968da9b6c04c133979e3622bca-dfnHKa",
        "width":500,
        "height":763,
    },
    {
        "key":"d6a5a7bbc954c8142ba71615241568e2e9b0b49fe2c7-rOHcPL",
        "width":440,
        "height":660,
    },
    {
        "key":"76b86d841c054380649adfed5c376a9b45fca1f8ef05-AxfoiL",
        "width":440,
        "height":660,
    },
    {
        "key":"6b6b7456148c8ea2f9aac886b8543f7d3f96ab4439698-xcw2n9",
        "width":1200,
        "height":1600,
    },
    {
        "key":"1f27335261f7d866344c5f5917f3ab66e10597ab1b122-t6Xi6e",
        "width":440,
        "height":595,
    },
    {
        "key":"427b42d75d0e789cd70d2fca6a670cc1adb33cb45303-6IpUJg",
        "width":345,
        "height":411,
    },
    {
        "key":"91579ea4ca11e6c865b9939fd62bc805c371ef4333c9-KxyFw1",
        "width":243,
        "height":357,
    },
    {
        "key":"a97f687f78f620788e35dd450c0bb68adef96cbb13e68-Frfyft",
        "width":400,
        "height":600,
    },
    {
        "key":"0fdb4139cff8dc16c7eb48da93eb4c1882994a2652896-Rzhaad",
        "width":1064,
        "height":1280,
    },
    {
        "key":"7d70d0df64371a5c973fb4194fa740ccf1cf2f2c93ac-TgXXPo",
        "width":350,
        "height":517,
    },
    {
        "key":"29e7e68e354326b7319f4a6f4edd600c9ca628e971c3c-wGOHyZ",
        "width":487,
        "height":672,
    },
    {
        "key":"bc958473fcf1873bba3391f489bd86c44da76b2123836-1qmYj1",
        "width":800,
        "height":1127,
    },
    {
        "key":"6797ca4423a7951892ce7be3fe7fc48a74433f91a88b8-HMIpsK",
        "width":1608,
        "height":2354,
    },
    {
        "key":"b0330ff2e4ca6386cf94a9bf06e3f0751854352139bb-SlL9VF",
        "width":250, 
        "height":310,
    },
]


var arr = dataInt;
$(window).ready(function() {
    waterfall();
    $(window).on( 'scroll' , function () {
        if (! checkScrollSlide() ) {
            return;
        }
         else {
            var ar = getShowItems();
            $.each(ar, function( key , value) {   
                var oImg = $('<img>');
                $(oImg).css('width' , '165px');
                $(oImg).css('height' , value.height / value.width * 165 +'px');
                $(oImg).css('padding' , '20px');
                $(oImg).attr('src' , './imgs/load.gif');
                var img = new Image();
                img.onload = function() {
                    $(oImg).attr('src' , 'http://hbimg.b0.upaiyun.com/' + value.key);
                }
                img.src = 'http://hbimg.b0.upaiyun.com/' + value.key
                var oPic = $('<div>').append($(oImg));
                var oBox = $('<div>').addClass('box').append($(oPic));
                
                $(oBox).appendTo($('#main'));
                waterfall();
            })
        }
    })
    arr = arr;
})
function getShowItems() {
   return arr.splice(0,5);
}
function waterfall() {
	var $boxs = $('#main>div');
	var w = $boxs.eq(0).outerWidth();
	var cols =Math.floor($(window).width() / w);
	$('#main').width(w * cols);
	$('#main').css('margin','0 auto');
	var hArr = [];
	$boxs.each(function(index , value){
		var h = $boxs.eq(index).outerHeight();
		if (index < cols) {
			hArr[index] = h;
		}
		else{
			var minH = Math.min.apply(null,hArr);
			var minHIndex = $.inArray(minH,hArr);
			$(value).css({
				'position' : 'absolute',
				'top' : minH + "px",
				'left' : minHIndex * w + 'px'
			})
			hArr[minHIndex] += $boxs.eq(index).outerHeight();
		}
 	})
}

function checkScrollSlide() {
	var $lastBox = $('#main > div').last();
	var lastBoxDis =$lastBox.offset().top + Math.floor($lastBox.outerHeight() / 2);
	var scrollTop = $(window).scrollTop();
	var documentH = $(window).height();
	return (lastBoxDis < scrollTop + documentH) ? true : false;
}